<div>
	<div class="pull-right">
		<span ng-show="current_signature.status=='DEPLOYED'" class="signature_status label label-success">{{current_signature.status}}</span>
		<span ng-show="current_signature.status=='NOISY'" class="signature_status label label-info">{{current_signature.status}}</span>
		<span ng-show="current_signature.status=='DISABLED'" class="signature_status label label-danger">{{current_signature.status}}</span>
		<span ng-show="current_signature.status=='TESTING'" class="signature_status label label-warning">{{current_signature.status}}</span>
		<span ng-show="current_signature.status=='STAGING'" class="signature_status label label-primary">{{current_signature.status}}</span>
		<span ng-show="current_signature.status=='INVALID'" class="signature_status label label-default">{{current_signature.status}}</span>
	</div>
	<ul class="nav nav-tabs" id="tabContent">
		<li id="preview_tab" class="active"><a href="#preview" data-toggle="tab">Preview</a></li>
		<li id="edit_tab"><a href="#edit" data-toggle="tab"><span ng-show="editmode">Edit</span><span ng-show="!editmode">Add</span> Signature</a></li>
		<li ng-if="current_signature_state=='TESTING'||current_signature_state=='STAGING'||user.is_admin" ng-show="editmode" id="state_tab"><a href="#state" data-toggle="tab">Change State</a></li>
	</ul>
				
	<div class="tab-content">
		<div class="tab-pane active" id="preview">
			<div ng-if="user.c12n_enforcing" class="pad">
				<div class="label classification {{current_signature.classification | class_label_color}}">{{current_signature.classification | class_long}}</div>
			</div>
			<pre class="rule_preview">{{current_signature.data}}</pre>
		</div>
		<div class="tab-pane" id="edit">
			<div class="pad">
				<p ng-show="current_signature.status=='DEPLOYED'||current_signature.status=='NOISY'||current_signature.status=='DISABLED'" class="text-center text-danger pad"><b>Warning:</b> Because this signature is not in a TESTING/STAGING phase anymore, any important modification will trigger a revision bump.</p>
				<div ng-if="user.c12n_enforcing" class="label classification {{current_signature.classification | class_label_color}}" data-toggle="modal" href="#classification_picker" ng-click="setClassification(current_signature.classification)">{{current_signature.classification | class_long}}</div>
			</div>
			<section class="row">
				<div class="col-md-12">
					<div class="pull-right">
						<a class="btn btn-xs btn-link" href="/yara_standard.html"><span class="glyphicon glyphicon-question-sign">&nbsp;</span>MALWARE&nbsp;Standard</a>&nbsp;
						<a class="btn btn-xs btn-link" href="/static/pdf/yara.pdf"><span class="glyphicon glyphicon-book">&nbsp;</span>Yara&nbsp;User&nbsp;Manual</a>
					</div>
					<div class="form-group">
						<label class="control-label">Signature Type</label>&nbsp;&nbsp;<label class="label label-danger">required</label>
						<select class="form-control input-sm" ng-model="current_signature.type">
							<option>tagcheck</option>
							<option>suricata</option>
							<option>yara</option>
						</select>
					</div>
					<div class="form-group">
						<label class="control-label">Signature Name</label>&nbsp;&nbsp;<label class="label label-danger">required</label>
						<input type="text" class="form-control input-sm " placeholder="Signature name" ng-model="current_signature.name">
					</div>
				</div>
			</section>
			<section class="row pad">
				<div class="col-md-12">
					<div class="form-group">
						<label class="control-label">Signature ID:</label>
						<input type="text" class="form-control input-sm" ng-model="current_signature.signature_id">
					</div>
				</div>
			</section>
			<section class="row pad">
				<div class="col-md-12">
					<div class="form-group">
						<label class="control-label">Revision #:</label>
						<input type="number" min="1" class="form-control input-sm" ng-model="current_signature.revision">
					</div>
				</div>
			</section>
			<section class="row pad">
				<div class="col-md-12">
					<div class="form-group">
						<label class="control-label">Source:</label>
						<input class="form-control input-sm" ng-model="current_signature.source">
					</div>
				</div>
			</section>
			<section class="row">
				<div class="col-md-12">
					<div class="form-group">
						<label class="control-label"><h4><strong>Signature:</strong></h4></label>&nbsp;&nbsp;<label class="label label-danger">required</label>
						<textarea style="font-family: monospace;" wrap="off" class="form-control input-sm" rows="3" placeholder="Put the full signature as it would show in a normal signature file" ng-model="current_signature.data"></textarea>
					</div>
				</div>
			</section>

			<button type="button" class="btn btn-primary" ng-click="save();">Save signature</button>
		</div>
		<div ng-show="editmode" class="tab-pane" id="state">
			<div class="pad">
				<h4>Changing the status of a signature</h4>
				<p>Before changing the signature state take note of the following:</p>
				<ul>
					<li>Only when the signature is in state TESTING or STAGING that you can edit any part of it without triggering a revision bump.</li>
					<li>After a signature has been either DEPLOYED, marked NOISY or DISABLED, it cannot go back in TESTING or STAGING status.</li>
					<li>Any important modification to a signature in DEPLOYED, NOISY or DISABLED status triggers a revision bump.</li>
					<li>Only one revision of a signature can run at the same time in the system.</li>
				</ul>
				<label>Choose the new signature state:</label>
				<select class="form-control" ng-model="current_signature.status" ng-change="set_state_change()">
					<option ng-if="user.is_admin && current_signature_state!='INVALID'">DEPLOYED</option>
					<option ng-if="user.is_admin && current_signature_state!='INVALID'">NOISY</option>
					<option ng-if="user.is_admin && current_signature_state!='INVALID'">DISABLED</option>
					<option ng-if="current_signature_state=='TESTING'||current_signature_state=='STAGING'||current_signature_state=='INVALID'">STAGING</option>
					<option ng-if="current_signature_state=='TESTING'||current_signature_state=='STAGING'||current_signature_state=='INVALID'">TESTING</option>
                    <option ng-if="current_signature_state=='INVALID'">INVALID</option>
				</select>
			</div>
			<button type="button" class="btn btn-primary" ng-click="change_state(current_signature.status);" ng-disabled="!state_changed">Save state</button>
		</div>
	</div>
</div>
